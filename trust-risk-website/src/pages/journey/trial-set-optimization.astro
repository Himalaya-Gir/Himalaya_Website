---
import Layout from '../../layouts/Layout.astro';
import Navigation from '../../components/Navigation.astro';
import { t } from '../../i18n/translations';
import '../../styles/global.css';

const lang = 'en';
---

<Layout title="Trial Set Optimization | Research Journey">
  <Navigation lang={lang} currentPath="/journey" />

  <main class="min-h-screen bg-[#FFF9ED]">
    <!-- Hero Section -->
    <section class="py-16 px-6">
      <div class="max-w-5xl mx-auto">
        <!-- Breadcrumb -->
        <div class="mb-6">
          <a href="/journey" class="text-sm text-[#003049] hover:text-[#780000] transition-colors inline-flex items-center gap-1.5 font-figtree font-medium">
            <svg class="w-3 h-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            Back to Research Journey
          </a>
        </div>

        <!-- Title -->
        <div class="mb-8">
          <div class="text-sm font-semibold text-[#780000] mb-3 uppercase tracking-wide font-figtree">Phase 3</div>
          <h1 class="font-figtree text-4xl md:text-5xl font-bold text-[#003049] mb-4">Trial Set Optimization</h1>
          <p class="text-lg text-[#003049]/70 leading-relaxed font-figtree max-w-3xl">
            Using <em class="italic">Fisher Information Matrix</em> and <em class="italic">Bayesian optimization</em> to select <strong>286 optimal trials</strong> across 32 nested models for maximum parameter discriminability.
          </p>
        </div>
      </div>
    </section>

    <!-- Main Content -->
    <section class="py-16 px-6">
      <div class="max-w-5xl mx-auto space-y-12">

        <!-- Overview -->
        <div class="relative overflow-hidden rounded-lg" style="clip-path: polygon(0 0, calc(100% - 32px) 0, 100% 32px, 100% 100%, 0 100%);">
          <!-- Split background -->
          <div class="grid grid-cols-12">
            <div class="col-span-3 bg-[#780000] p-10 flex items-center justify-center">
              <div class="font-figtree text-7xl font-black text-[#FFF9ED]" style="writing-mode: vertical-rl; text-orientation: mixed; letter-spacing: -0.05em;">01</div>
            </div>
            <div class="col-span-9 bg-[#FFF9ED] p-10">
              <h2 class="font-figtree text-4xl font-bold text-[#003049] mb-6" style="text-wrap: balance; letter-spacing: -0.02em;">Overview</h2>
              <div class="space-y-4">
                <p class="font-figtree text-lg text-[#003049]/80 leading-relaxed">
                  The challenge: how do you design an experiment that can distinguish between <strong>32 different computational models</strong> of decision-making, each with up to <strong>6 parameters</strong>?
                </p>
                <p class="font-figtree text-lg text-[#003049]/80 leading-relaxed">
                  Traditional experimental design would require <strong>thousands of trials</strong>. We needed a <em class="italic">smarter approach</em>.
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- The Challenge -->
        <div class="border-l-4 border-[#669bbc] pl-8 py-6">
          <h2 class="font-figtree text-3xl font-bold text-[#003049] mb-8">The Challenge</h2>

          <div class="grid md:grid-cols-2 gap-8">
            <div>
              <h3 class="font-figtree text-xl font-semibold text-[#780000] mb-4">Model Space</h3>
              <ul class="space-y-3 text-[#003049]/80 font-figtree">
                <li class="flex items-start gap-2">
                  <span class="text-[#780000] mt-1">•</span>
                  <span><strong>32 hierarchically nested models</strong></span>
                </li>
                <li class="flex items-start gap-2">
                  <span class="text-[#780000] mt-1">•</span>
                  <span>Each combining different <em class="italic">Prospect Theory</em> parameters</span>
                </li>
                <li class="flex items-start gap-2">
                  <span class="text-[#780000] mt-1">•</span>
                  <span>α (value sensitivity), γ (probability weighting), δ (trust weighting), λ (loss aversion), τ (choice stochasticity), φ (belief updating)</span>
                </li>
              </ul>
            </div>

            <div>
              <h3 class="font-figtree text-xl font-semibold text-[#780000] mb-4">Constraints</h3>
              <ul class="space-y-3 text-[#003049]/80 font-figtree">
                <li class="flex items-start gap-2">
                  <span class="text-[#780000] mt-1">•</span>
                  <span>Participant <em class="italic">fatigue</em> limits trial count</span>
                </li>
                <li class="flex items-start gap-2">
                  <span class="text-[#780000] mt-1">•</span>
                  <span>Need <strong>balanced coverage</strong> of probability space</span>
                </li>
                <li class="flex items-start gap-2">
                  <span class="text-[#780000] mt-1">•</span>
                  <span>Must work across <strong>Trust and Risk games</strong></span>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- The Solution -->
        <div class="bg-[#003049] px-8 py-8 rounded-lg">
          <h2 class="font-figtree text-3xl font-bold text-[#FFF9ED] mb-6">The Solution</h2>
          <h3 class="font-figtree text-2xl font-semibold text-[#669bbc] mb-8"><em class="italic">Fisher Information Optimization</em></h3>

          <div class="space-y-8">
            <div>
              <h4 class="font-figtree text-xl font-semibold text-[#FFF9ED] mb-3">Step 1: Parameter Space Sampling</h4>
              <p class="font-figtree text-[#FFF9ED]/85 leading-relaxed mb-4">
                Generated <strong>10,000 parameter combinations</strong> across the 6-dimensional parameter space, using realistic ranges derived from <em class="italic">literature review</em>.
              </p>
              <div class="bg-[#FFF9ED]/10 border border-[#FFF9ED]/20 text-[#FFF9ED] p-4 rounded font-mono text-sm overflow-x-auto">
                α ∈ [0.3, 1.5]  <span class="text-[#669bbc]"># Value sensitivity</span><br/>
                γ ∈ [0.3, 1.5]  <span class="text-[#669bbc]"># Probability weighting</span><br/>
                δ ∈ [0.0, 1.0]  <span class="text-[#669bbc]"># Trust-specific weighting</span><br/>
                λ ∈ [1.0, 3.0]  <span class="text-[#669bbc]"># Loss aversion</span><br/>
                τ ∈ [0.1, 5.0]  <span class="text-[#669bbc]"># Choice stochasticity</span><br/>
                φ ∈ [0.0, 1.0]  <span class="text-[#669bbc]"># Belief updating rate</span>
              </div>
            </div>

            <div>
              <h4 class="font-figtree text-xl font-semibold text-[#FFF9ED] mb-3">Step 2: Fisher Information Matrix</h4>
              <p class="font-figtree text-[#FFF9ED]/85 leading-relaxed mb-4">
                For each parameter combination and trial configuration, computed the <strong>Fisher Information Matrix</strong> — a measure of how much <em class="italic">information</em> a trial provides about the parameters.
              </p>
              <div class="bg-[#FFF9ED]/10 border border-[#FFF9ED]/20 text-[#FFF9ED] p-4 rounded font-mono text-sm overflow-x-auto">
                <span class="text-[#669bbc]">def</span> <span class="text-[#FFF9ED]">fisher_information</span>(trial, params):<br/>
                &nbsp;&nbsp;<span class="text-[#669bbc]/80"># Compute gradient of log-likelihood</span><br/>
                &nbsp;&nbsp;grad = ∇<sub>θ</sub> log P(choice | trial, θ)<br/>
                &nbsp;&nbsp;<span class="text-[#669bbc]">return</span> grad @ grad.T
              </div>
            </div>

            <div>
              <h4 class="font-figtree text-xl font-semibold text-[#FFF9ED] mb-3">Step 3: Bayesian Optimization</h4>
              <p class="font-figtree text-[#FFF9ED]/85 leading-relaxed">
                Used <strong>Bayesian optimization</strong> to select the <strong>286 trials</strong> that maximize the determinant of the Fisher Information Matrix (<em class="italic">D-optimality criterion</em>) averaged across all parameter combinations and models.
              </p>
            </div>
          </div>
        </div>

        <!-- Results -->
        <div class="border-l-4 border-[#669bbc] pl-8 py-6">
          <h2 class="font-figtree text-3xl font-bold text-[#003049] mb-8">Outcomes</h2>

          <div class="grid md:grid-cols-3 gap-8">
            <div>
              <div class="font-figtree text-5xl font-bold text-[#780000] mb-2">286</div>
              <div class="font-figtree text-sm text-[#003049] font-semibold mb-3 uppercase tracking-wide">Optimally Selected Trials</div>
              <p class="font-figtree text-sm text-[#003049]/70 leading-relaxed">
                Balanced across <em class="italic">probability distributions</em> and game types
              </p>
            </div>

            <div>
              <div class="font-figtree text-5xl font-bold text-[#780000] mb-2">~85%</div>
              <div class="font-figtree text-sm text-[#003049] font-semibold mb-3 uppercase tracking-wide">Parameter Recovery</div>
              <p class="font-figtree text-sm text-[#003049]/70 leading-relaxed">
                Achieved <strong>high parameter discriminability</strong> across the model space
              </p>
            </div>

            <div>
              <div class="font-figtree text-5xl font-bold text-[#780000] mb-2">~45min</div>
              <div class="font-figtree text-sm text-[#003049] font-semibold mb-3 uppercase tracking-wide">Experiment Duration</div>
              <p class="font-figtree text-sm text-[#003049]/70 leading-relaxed">
                Reasonable length while <em class="italic">maximizing information gain</em>
              </p>
            </div>
          </div>
        </div>

        <!-- Technical Details -->
        <div class="border-l-4 border-[#780000] pl-8 py-6">
          <h2 class="font-figtree text-3xl font-bold text-[#003049] mb-6">Technical Implementation</h2>

          <div class="space-y-3 font-figtree text-[#003049]/80">
            <div class="flex items-start gap-3">
              <span class="text-[#780000] mt-1">•</span>
              <div>
                <strong class="text-[#003049]">Computing Environment:</strong> Python with <em class="italic">NumPy, SciPy, JAX</em> for automatic differentiation
              </div>
            </div>
            <div class="flex items-start gap-3">
              <span class="text-[#780000] mt-1">•</span>
              <div>
                <strong class="text-[#003049]">Optimization:</strong> <strong>Gaussian Process-based Bayesian Optimization</strong> (scikit-optimize)
              </div>
            </div>
            <div class="flex items-start gap-3">
              <span class="text-[#780000] mt-1">•</span>
              <div>
                <strong class="text-[#003049]">Validation:</strong> <em class="italic">Monte Carlo simulations</em> with synthetic agents to verify parameter recovery
              </div>
            </div>
            <div class="flex items-start gap-3">
              <span class="text-[#780000] mt-1">•</span>
              <div>
                <strong class="text-[#003049]">Computation Time:</strong> <strong>~72 hours</strong> on a 16-core workstation
              </div>
            </div>
          </div>
        </div>

      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="py-12 px-6 bg-[#003049] text-[#FFF9ED]">
    <div class="max-w-4xl mx-auto text-center">
      <p class="font-poppins text-lg mb-4 font-semibold">Himalaya Girard</p>
      <p class="font-figtree text-[#669bbc] mb-6">{t('footer.position', lang)}</p>
      <p class="font-figtree text-sm text-[#669bbc]/70 mt-8">
        {t('footer.rights', lang)}
      </p>
    </div>
  </footer>
</Layout>
